(function(n,r){"object"===typeof exports&&"undefined"!==typeof module?r(exports):"function"===typeof define&&define.amd?define(["exports"],r):(n="undefined"!==typeof globalThis?globalThis:n||self,r(n.rfc6902={}))})(this,function(n){function r(a){return a.replace(/~1/g,"/").replace(/~0/g,"~")}function H(a){return a.replace(/~/g,"~0").replace(/\//g,"~1")}function A(a){return void 0===a?"undefined":null===a?"null":Array.isArray(a)?"array":typeof a}function t(a){if(null==a||"object"!=typeof a)return a;
if(a.constructor==Array){var b=a.length,c=Array(b);for(let d=0;d<b;d++)c[d]=t(a[d]);return c}if(a.constructor==Date)return new Date(+a);b={};for(c in a)u.call(a,c)&&(b[c]=t(a[c]));return b}function I({op:a}){return"remove"===a||"replace"===a||"copy"===a||"move"===a}function B(a,b){const c=[];for(const d in a)!u.call(a,d)||void 0===a[d]||u.call(b,d)&&void 0!==b[d]||c.push(d);return c}function J(a,b){const c=[];for(const d in a)u.call(a,d)&&void 0!==a[d]&&u.call(b,d)&&void 0!==b[d]&&c.push(d);return c}
function x(a,b){return{operation:b,cost:a?a.cost+1:1,base:a}}function K(a){const b=[];for(;a;)b.push(a.operation),a=a.base;return b.reverse()}function L(a,b,c,d=q){function e(f,g){const h=f*k+g;var l=C.get(h);if(void 0===l){if(0<f&&0<g&&!d(a[f-1],b[g-1],c.add(String(f-1))).length)l=e(f-1,g-1);else{l=[];if(0<f){var v=e(f-1,g);l.push(x(v,{op:"remove",index:f-1}))}0<g&&(v=e(f,g-1),l.push(x(v,{op:"add",index:f-1,value:b[g-1]})));0<f&&0<g&&(v=e(f-1,g-1),l.push(x(v,{op:"replace",index:f-1,original:a[f-
1],value:b[g-1]})));f=Infinity;let D;for(const y of l)y.cost<f&&(f=y.cost,D=y);l=D}C.set(h,l)}return l}const k=Math.max(a.length,b.length),C=new Map([[0,void 0]]),E=isNaN(a.length)||0>=a.length?0:a.length;var w=isNaN(b.length)||0>=b.length?0:b.length;w=K(e(E,w));[w]=w.reduce(([f,g],h)=>{if("add"===h.op){var l=h.index+1+g;h={op:h.op,path:c.add(l<E+g?String(l):"-").toString(),value:h.value};return[f.concat(h),g+1]}if("remove"===h.op)return h={op:h.op,path:c.add(String(h.index+g)).toString()},[f.concat(h),
g-1];l=c.add(String(h.index+g));h=d(h.original,h.value,l);return[f.concat(...h),g]},[[],0]);return w}function M(a,b,c,d=q){const e=[];B(a,b).forEach(k=>{e.push({op:"remove",path:c.add(k).toString()})});B(b,a).forEach(k=>{e.push({op:"add",path:c.add(k).toString(),value:b[k]})});J(a,b).forEach(k=>{e.push(...d(a[k],b[k],c.add(k)))});return e}function q(a,b,c,d=q){if(a===b)return[];const e=A(a),k=A(b);return"array"==e&&"array"==k?L(a,b,c,d):"object"==e&&"object"==k?M(a,b,c,d):[{op:"replace",path:c.toString(),
value:b}]}function z(a,b,c){Array.isArray(a)?"-"==b?a.push(c):(b=parseInt(b,10),a.splice(b,0,c)):a[b]=c}function F(a,b){Array.isArray(a)?(b=parseInt(b,10),a.splice(b,1)):delete a[b]}function N(a,b){a=m.fromJSON(b.path).evaluate(a);if(null===a.parent)return new p(b.path);if(Array.isArray(a.parent)){if(parseInt(a.key,10)>=a.parent.length)return new p(b.path)}else if(void 0===a.value)return new p(b.path);a.parent[a.key]=t(b.value);return null}function O(a,b){switch(b.op){case "add":return a=m.fromJSON(b.path).evaluate(a),
void 0===a.parent?b=new p(b.path):(z(a.parent,a.key,t(b.value)),b=null),b;case "remove":return a=m.fromJSON(b.path).evaluate(a),void 0===a.value?b=new p(b.path):(F(a.parent,a.key),b=null),b;case "replace":return N(a,b);case "move":var c=m.fromJSON(b.from).evaluate(a);void 0===c.value?b=new p(b.from):(a=m.fromJSON(b.path).evaluate(a),void 0===a.parent?b=new p(b.path):(F(c.parent,c.key),z(a.parent,a.key,c.value),b=null));return b;case "copy":return c=m.fromJSON(b.from).evaluate(a),void 0===c.value?
b=new p(b.from):(a=m.fromJSON(b.path).evaluate(a),void 0===a.parent?b=new p(b.path):(z(a.parent,a.key,t(c.value)),b=null)),b;case "test":return a=m.fromJSON(b.path).evaluate(a),b=q(a.value,b.value,new m).length?new P(a.value,b.value):null,b}return new Q(b)}function R(a){function b(c,d,e){const k=a(c,d,e);return Array.isArray(k)?k:q(c,d,e,b)}return b}function G(a,b){a=m.fromJSON(b).evaluate(a);if(void 0!==a)return{op:"test",path:b,value:a.value}}class m{constructor(a=[""]){this.tokens=a}static fromJSON(a){const b=
a.split("/").map(r);if(""!==b[0])throw Error(`Invalid JSON Pointer: ${a}`);return new m(b)}toString(){return this.tokens.map(H).join("/")}evaluate(a){let b=null,c="";for(let d=1,e=this.tokens.length;d<e;d++)b=a,c=this.tokens[d],"__proto__"!=c&&"constructor"!=c&&"prototype"!=c&&(a=(b||{})[c]);return{parent:b,key:c,value:a}}get(a){return this.evaluate(a).value}set(a,b){a=this.evaluate(a);a.parent&&(a.parent[a.key]=b)}push(a){this.tokens.push(a)}add(a){a=this.tokens.concat(String(a));return new m(a)}}
const u=Object.prototype.hasOwnProperty;class p extends Error{constructor(a){super(`Value required at path: ${a}`);this.path=a;this.name="MissingError"}}class P extends Error{constructor(a,b){super(`Test failed: ${a} != ${b}`);this.actual=a;this.expected=b;this.name="TestError"}}class Q extends Error{constructor(a){super(`Invalid operation: ${a.op}`);this.operation=a;this.name="InvalidOperationError"}}n.Pointer=m;n.applyPatch=function(a,b){return b.map(c=>O(a,c))};n.createPatch=function(a,b,c){const d=
new m;return(c?R(c):q)(a,b,d)};n.createTests=function(a,b){const c=[];b.filter(I).forEach(d=>{const e=G(a,d.path);e&&c.push(e);"from"in d&&(d=G(a,d.from))&&c.push(d)});return c};Object.defineProperty(n,"__esModule",{value:!0})});
